<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content=" 2025-03-07 - ë‚´ìš© ìˆ˜ì • ì´ì „ ê¸€ì—ëŠ” ìƒíƒœë¥¼ ì–´ë–»ê²Œ ì •ì˜í–ˆëŠ”ì§€ ì„¤ëª…í–ˆìŠµë‹ˆë‹¤. ì§€ê¸ˆë¶€í„° ì–´ë–»ê²Œ Challengeë¥¼ ìƒì„±, ì‚­ì œí•  ìˆ˜ ìˆëŠ”ì§€ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\nì¡°ê±´ ìƒê°í•˜ê¸° ìš°ì„  ìƒì„±ê³¼ ì‚­ì œ ë¡œì§ì„ ì„¤ëª…í•˜ê¸° ì´ì „ì— ìƒì„±ê³¼ ì‚­ì œ ì‹œ ë¬´ì¡°ê±´ ìˆ˜í–‰ë˜ì–´ì•¼ í•˜ëŠ” ì¡°ê±´ì„ ì •ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤.\n"><title>HexaCTF 8. ì»¤ìŠ¤í…€ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í†µí•œ Challenge ìƒì„± ë° ì‚­ì œ êµ¬í˜„</title>
<link rel=canonical href=https://s0okju.github.io/p/hexactf-8/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="HexaCTF 8. ì»¤ìŠ¤í…€ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í†µí•œ Challenge ìƒì„± ë° ì‚­ì œ êµ¬í˜„"><meta property='og:description' content=" 2025-03-07 - ë‚´ìš© ìˆ˜ì • ì´ì „ ê¸€ì—ëŠ” ìƒíƒœë¥¼ ì–´ë–»ê²Œ ì •ì˜í–ˆëŠ”ì§€ ì„¤ëª…í–ˆìŠµë‹ˆë‹¤. ì§€ê¸ˆë¶€í„° ì–´ë–»ê²Œ Challengeë¥¼ ìƒì„±, ì‚­ì œí•  ìˆ˜ ìˆëŠ”ì§€ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\nì¡°ê±´ ìƒê°í•˜ê¸° ìš°ì„  ìƒì„±ê³¼ ì‚­ì œ ë¡œì§ì„ ì„¤ëª…í•˜ê¸° ì´ì „ì— ìƒì„±ê³¼ ì‚­ì œ ì‹œ ë¬´ì¡°ê±´ ìˆ˜í–‰ë˜ì–´ì•¼ í•˜ëŠ” ì¡°ê±´ì„ ì •ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤.\n"><meta property='og:url' content='https://s0okju.github.io/p/hexactf-8/'><meta property='og:site_name' content='S0okJu.dev'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Openstack'><meta property='article:tag' content='Kubernetes'><meta property='article:published_time' content='2025-03-04T00:00:00+09:00'><meta property='article:modified_time' content='2025-03-04T00:00:00+09:00'><meta name=twitter:title content="HexaCTF 8. ì»¤ìŠ¤í…€ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í†µí•œ Challenge ìƒì„± ë° ì‚­ì œ êµ¬í˜„"><meta name=twitter:description content=" 2025-03-07 - ë‚´ìš© ìˆ˜ì • ì´ì „ ê¸€ì—ëŠ” ìƒíƒœë¥¼ ì–´ë–»ê²Œ ì •ì˜í–ˆëŠ”ì§€ ì„¤ëª…í–ˆìŠµë‹ˆë‹¤. ì§€ê¸ˆë¶€í„° ì–´ë–»ê²Œ Challengeë¥¼ ìƒì„±, ì‚­ì œí•  ìˆ˜ ìˆëŠ”ì§€ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\nì¡°ê±´ ìƒê°í•˜ê¸° ìš°ì„  ìƒì„±ê³¼ ì‚­ì œ ë¡œì§ì„ ì„¤ëª…í•˜ê¸° ì´ì „ì— ìƒì„±ê³¼ ì‚­ì œ ì‹œ ë¬´ì¡°ê±´ ìˆ˜í–‰ë˜ì–´ì•¼ í•˜ëŠ” ì¡°ê±´ì„ ì •ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤.\n"><link rel="shortcut icon" href=/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_c3a763b4e1e1539a.png width=300 height=248 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸ‘¾</span></figure><div class=site-meta><h1 class=site-name><a href=/>S0okJu.dev</a></h1><h2 class=site-description>ê²½í—˜ìœ¼ë¡œ í•™ìŠµí•©ë‹ˆë‹¤.</h2></div></header><ol class=menu-social><li><a href=https://github.com/S0okJu target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#ì¡°ê±´-ìƒê°í•˜ê¸°>ì¡°ê±´ ìƒê°í•˜ê¸°</a></li><li><a href=#builderë¥¼-í†µí•´-controllerë¥¼-ì„¤ì •í•œë‹¤>Builderë¥¼ í†µí•´ Controllerë¥¼ ì„¤ì •í•œë‹¤.</a></li><li><a href=#controllerëŠ”-reconcilerë¥¼-í†µí•´-reconcileë¥¼-ì‹¤í–‰í•œë‹¤>ControllerëŠ” Reconcilerë¥¼ í†µí•´ Reconcile()ë¥¼ ì‹¤í–‰í•œë‹¤.</a></li><li><a href=#challenge-ë¦¬ì†ŒìŠ¤-ìƒì„±>Challenge ë¦¬ì†ŒìŠ¤ ìƒì„±</a><ol><li><a href=#ì‰½ê²Œ-ì‚­ì œí• -ìˆ˜-ìˆë„ë¡-challengeë¥¼-ë§Œë“¤ì>ì‰½ê²Œ ì‚­ì œí•  ìˆ˜ ìˆë„ë¡ Challengeë¥¼ ë§Œë“¤ì!</a><ol><li><a href=#êµ¬í˜„>êµ¬í˜„</a></li></ol></li><li><a href=#ìƒíƒœë¥¼-ê°ì§€í•˜ê³ -ë³€ê²½í•˜ëŠ”-ë°©ë²•>ìƒíƒœë¥¼ ê°ì§€í•˜ê³  ë³€ê²½í•˜ëŠ” ë°©ë²•</a></li><li><a href=#ì»¨íŠ¸ë¡¤ëŸ¬-êµ¬í˜„ì—-ì¤‘ìš”í•œ-ê²ƒì€---ë©±ë“±ì„±>ì»¨íŠ¸ë¡¤ëŸ¬ êµ¬í˜„ì— ì¤‘ìš”í•œ ê²ƒì€? - ë©±ë“±ì„±</a></li></ol></li><li><a href=#challenge-ë¦¬ì†ŒìŠ¤-ì‚­ì œ>Challenge ë¦¬ì†ŒìŠ¤ ì‚­ì œ</a><ol><li><a href=#ì‚­ì œ-ìƒíƒœë¥¼-ì•Œë¦¬ê¸°-ìœ„í•œ-finalizer-ì´ìš©>ì‚­ì œ ìƒíƒœë¥¼ ì•Œë¦¬ê¸° ìœ„í•œ Finalizer ì´ìš©</a></li><li><a href=#ë¦¬ì†ŒìŠ¤ê°€-ì‚­ì œë˜ëŠ”-2ê°€ì§€-ë°©ë²•>ë¦¬ì†ŒìŠ¤ê°€ ì‚­ì œë˜ëŠ” 2ê°€ì§€ ë°©ë²•</a></li></ol></li><li><a href=#ì •ë¦¬>ì •ë¦¬</a></li><li><a href=#ë§ˆì¹˜ë©°>ë§ˆì¹˜ë©°</a></li><li><a href=#ì°¸ê³ >ì°¸ê³ </a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/hexactf/>HexaCTF</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/hexactf-8/>HexaCTF 8. ì»¤ìŠ¤í…€ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í†µí•œ Challenge ìƒì„± ë° ì‚­ì œ êµ¬í˜„</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Mar 04, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>11 minute read</time></div></footer></div></header><section class=article-content><ul><li>2025-03-07 - ë‚´ìš© ìˆ˜ì •</li></ul><p>ì´ì „ ê¸€ì—ëŠ” ìƒíƒœë¥¼ ì–´ë–»ê²Œ ì •ì˜í–ˆëŠ”ì§€ ì„¤ëª…í–ˆìŠµë‹ˆë‹¤. ì§€ê¸ˆë¶€í„° ì–´ë–»ê²Œ Challengeë¥¼ ìƒì„±, ì‚­ì œí•  ìˆ˜ ìˆëŠ”ì§€ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.</p><h2 id=ì¡°ê±´-ìƒê°í•˜ê¸°>ì¡°ê±´ ìƒê°í•˜ê¸°</h2><p>ìš°ì„  ìƒì„±ê³¼ ì‚­ì œ ë¡œì§ì„ ì„¤ëª…í•˜ê¸° ì´ì „ì— ìƒì„±ê³¼ ì‚­ì œ ì‹œ ë¬´ì¡°ê±´ ìˆ˜í–‰ë˜ì–´ì•¼ í•˜ëŠ” ì¡°ê±´ì„ ì •ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤.</p><ul><li>ìƒì„±<ul><li>Deployment, Service ìƒì„±</li></ul></li><li>ì‚­ì œ<ul><li>ì¡°ê±´ì— ë”°ë¼ 30ë¶„ í›„ ì‚­ì œ -> ìƒì„±ì¼ ê¸°ì¤€ìœ¼ë¡œ ì¢…ë£Œì¼ ì§€ì •</li><li>Challenge ì‚­ì œ ì‹œ ê´€ë ¨ Deployment, Service ì‚­ì œ -> ë¬´ì–¸ê°€ë¥¼ í†µí•´ ì—°ê²°ë˜ì–´ì•¼ í•¨</li></ul></li></ul><p>ì£¼ë¡œ <strong>ì‚­ì œ ë¡œì§ì„ ì¤‘ì‹¬</strong>ìœ¼ë¡œ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤. ì‚­ì œë¥¼ ì œëŒ€ë¡œ ì œì–´í•˜ì§€ ì•Šìœ¼ë©´ ê³ ì•„ ë¦¬ì†ŒìŠ¤ê°€ ìƒê¸°ëŠ” ë¬¸ì œê°€ ë°œìƒí•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.</p><h2 id=builderë¥¼-í†µí•´-controllerë¥¼-ì„¤ì •í•œë‹¤>Builderë¥¼ í†µí•´ Controllerë¥¼ ì„¤ì •í•œë‹¤.</h2><p>ê³µì‹ ë¬¸ì„œì— ì˜í•˜ë©´ BuilderëŠ” controller-runtimeì„ ê°ì‹¸ë©°, ì¼ë°˜ì ì¸ controllerë¥¼ êµ¬ì¶•í•˜ê¸° ìœ„í•œ íŒ¨í„´ì„ ì œê³µí•œë‹¤ê³  í•©ë‹ˆë‹¤.</p><p>ì´ì „ ê¸€ì—ì„œ ì œê°€ í–ˆë˜ ì´ì•¼ê¸° ìƒê° ë‚˜ì‹œë‚˜ìš”? <strong>ì˜¤í¼ë ˆì´í„°ë¥¼ ë§Œë“ ë‹¤ëŠ” ê²ƒì€ ëŒ€ìƒ ë¦¬ì†ŒìŠ¤ë¥¼ ì œì–´í•˜ëŠ” controllerì™€ Controllerë¥¼ ê´€ë¦¬í•˜ëŠ” Manangerë¥¼ ë§Œë“ ë‹¤</strong>ëŠ” ê²ƒì´ê³ , <strong>KubebuilderëŠ” controllerë¥¼ ë¹Œë“œí•˜ëŠ” í”„ë¡œê·¸ë¨</strong>ì´ë¼ê³  ë§í–ˆìŠµë‹ˆë‹¤.</p><blockquote><p><strong>Manager</strong>
controllerë¥¼ ì œì‘í•˜ëŠ”ë° í•„ìš”í•˜ë©° client, caches, schemesë“± ì˜ ê³µìœ  ë””íœë˜ì‹œë¥¼ ì œê³µí•œë‹¤. ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” Manager.Startë¥¼ í˜¸ì¶œí•˜ì—¬ ì‹œì‘ë˜ì–´ì•¼ í•œë‹¤.
<a class=link href=https://pkg.go.dev/sigs.k8s.io/controller-runtime/pkg/manager target=_blank rel=noopener>ê³µì‹ ë¬¸ì„œ</a></p></blockquote><p>ì‹¤ì œ ì½”ë“œ ìƒì—ì„œëŠ” kubebuilderê°€ Managerë¼ëŠ” ê°ì²´ ìƒì„±í•´ì¤ë‹ˆë‹¤.(<code>cmd/main.go</code>)</p><blockquote><p>ManagerëŠ” ê³ ê°€ìš©ì„±ì„ ìœ„í•´ Controllerë“¤ì˜ leader electionë„ ìˆ˜í–‰í•©ë‹ˆë‹¤.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl>	<span class=nx>mgr</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>ctrl</span><span class=p>.</span><span class=nf>NewManager</span><span class=p>(</span><span class=nx>ctrl</span><span class=p>.</span><span class=nf>GetConfigOrDie</span><span class=p>(),</span> <span class=nx>ctrl</span><span class=p>.</span><span class=nx>Options</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Scheme</span><span class=p>:</span>                 <span class=nx>scheme</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Metrics</span><span class=p>:</span>                <span class=nx>metricsServerOptions</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>WebhookServer</span><span class=p>:</span>          <span class=nx>webhookServer</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>HealthProbeBindAddress</span><span class=p>:</span> <span class=nx>probeAddr</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>LeaderElection</span><span class=p>:</span>         <span class=nx>enableLeaderElection</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>LeaderElectionID</span><span class=p>:</span>       <span class=s>&#34;958dbbf6.hexactf.io&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=c1>// LeaderElectionReleaseOnCancel defines if the leader should step down voluntarily</span>
</span></span><span class=line><span class=cl>		<span class=c1>// when the Manager ends. This requires the binary to immediately end when the</span>
</span></span><span class=line><span class=cl>		<span class=c1>// Manager is stopped, otherwise, this setting is unsafe. Setting this significantly</span>
</span></span><span class=line><span class=cl>		<span class=c1>// speeds up voluntary leader transitions as the new leader don&#39;t have to wait</span>
</span></span><span class=line><span class=cl>		<span class=c1>// LeaseDuration time first.</span>
</span></span><span class=line><span class=cl>		<span class=c1>//</span>
</span></span><span class=line><span class=cl>		<span class=c1>// In the default scaffold provided, the program ends immediately after</span>
</span></span><span class=line><span class=cl>		<span class=c1>// the manager stops, so would be fine to enable this option. However,</span>
</span></span><span class=line><span class=cl>		<span class=c1>// if you are doing or is intended to do any operation such as perform cleanups</span>
</span></span><span class=line><span class=cl>		<span class=c1>// after the manager stops then its usage might be unsafe.</span>
</span></span><span class=line><span class=cl>		<span class=c1>// LeaderElectionReleaseOnCancel: true,</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>setupLog</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=s>&#34;unable to start manager&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>os</span><span class=p>.</span><span class=nf>Exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ìš”êµ¬ì‚¬í•­ì— ë”°ë¼ì„œ í•˜ë‚˜ì˜ í”„ë¡œì íŠ¸ì— 2ê°œ ì´ìƒì˜ controllerë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í˜„ì¬ ì €í¬ ëŒ€íšŒì—ì„œëŠ” Challenge Controller í•˜ë‚˜ë§Œ í•„ìš”í•˜ê¸° ë•Œë¬¸ì— í•˜ë‚˜ë§Œ ë§Œë“  ê²ƒ ë¿ì…ë‹ˆë‹¤.
ManagerëŠ” Controllerë¥¼ ì œì–´í•˜ëŠ” ì—­í• ì„ ê°€ì§„ë‹¤ê³  ì„¤ëª…í–ˆì£ ? <strong>ì²˜ìŒ Manangerê°€ ì—¬ëŸ¬ê°œì˜ controllerë¥¼ ì œì–´í•˜ê¸° ìœ„í•´ì„œëŠ” Managerì— Controller ë“±ë¡ ì‘ì—…ì´ í•„ìš”í•©ë‹ˆë‹¤.</strong> ê·¸ë¦¬ê³  ì´ ë¶€ë¶„ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ controller íŒŒì¼ ìƒì„± ì‹œ ìë™ìœ¼ë¡œ ì œê³µí•©ë‹ˆë‹¤.</p><p>ë‹¤ì‹œ ëŒì•„ì™€ì„œ BuilderëŠ” Challenge Controllerë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ ì–´ë–¤ ì •ë³´ê°€ í•„ìš”í• ê¹Œìš”?</p><ul><li>Controllerë¥¼ ì œì–´í•  Manager</li><li>Controller ëŒ€ìƒ ë¦¬ì†ŒìŠ¤</li><li>Controllerì— ì‚½ì…í•  Reconcile í•¨ìˆ˜</li></ul><p>kubebuilderë¥¼ í†µí•´ ìë™ìœ¼ë¡œ controllerë¥¼ ìƒì„±í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ ë¹Œë“œ ë¡œì§ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// SetupWithManager sets up the controller with the Manager.</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>r</span> <span class=o>*</span><span class=nx>ChallengeReconciler</span><span class=p>)</span> <span class=nf>SetupWithManager</span><span class=p>(</span><span class=nx>mgr</span> <span class=nx>ctrl</span><span class=p>.</span><span class=nx>Manager</span><span class=p>)</span> <span class=kt>error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// Builder ì´ˆê¸°í™”</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>ctrl</span><span class=p>.</span><span class=nf>NewControllerManagedBy</span><span class=p>(</span><span class=nx>mgr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=c1>// Challengeë¼ëŠ” ëŒ€ìƒ ë¦¬ì†ŒìŠ¤</span>
</span></span><span class=line><span class=cl>		<span class=nf>For</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>hexactfproj</span><span class=p>.</span><span class=nx>Challenge</span><span class=p>{}).</span>
</span></span><span class=line><span class=cl>		<span class=nf>Owns</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>Deployment</span><span class=p>{}).</span>
</span></span><span class=line><span class=cl>		<span class=nf>Owns</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Service</span><span class=p>{}).</span><span class=o>/</span>
</span></span><span class=line><span class=cl>		<span class=nf>Named</span><span class=p>(</span><span class=s>&#34;challenge&#34;</span><span class=p>).</span>
</span></span><span class=line><span class=cl>		<span class=c1>// Controllerì— ChallengeReconcilerë¥¼ ì‚½ì…</span>
</span></span><span class=line><span class=cl>		<span class=nf>Complete</span><span class=p>(</span><span class=nx>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=controllerëŠ”-reconcilerë¥¼-í†µí•´-reconcileë¥¼-ì‹¤í–‰í•œë‹¤>ControllerëŠ” Reconcilerë¥¼ í†µí•´ Reconcile()ë¥¼ ì‹¤í–‰í•œë‹¤.</h2><p>ControllerëŠ” íƒ€ê²Ÿ ë¦¬ì†ŒìŠ¤(Challenge)ë¥¼ ëª¨ë‹ˆí„°ë§í•˜ê³  ë³€ê²½ ì‹œ <code>Reconciler</code> í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œí‚µë‹ˆë‹¤. Reconciler í•¨ìˆ˜ëŠ” kube-apiserverë¥¼ í†µí•´ ëŒ€ìƒ ë¦¬ì†ŒìŠ¤ì˜ ë³€ê²½ ì‚¬í•­ì„ í™•ì¸í•©ë‹ˆë‹¤. ë§Œì•½ì— ë³€ê²½ ì‚¬í•­ì´ ê°ì§€ê°€ ë˜ì—ˆë‹¤ë©´ <code>Reconcile</code> í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œí‚µë‹ˆë‹¤.</p><p>ë§¨ ì²«ë¶€ë¶„ì— ë§í•œ ì¡°ê±´ì€ ëª¨ë‘ <code>Reconcile</code> í•¨ìˆ˜ ë‚´ì— êµ¬í˜„í•˜ê²Œ ë©ë‹ˆë‹¤.</p><blockquote><p>êµ¬ì²´ì ì¸ ë‚´ìš©ì€ <a class=link href=https://nakamasato.medium.com/kubernetes-operator-series-6-controller-runtime-component-controller-604c8905a1e1 target=_blank rel=noopener>Kubernetes Operator series 6 â€” controller-runtime component â€” Controller | by Masato Naka | Medium</a> ì½ëŠ” ê²ƒì„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.</p></blockquote><h2 id=challenge-ë¦¬ì†ŒìŠ¤-ìƒì„±>Challenge ë¦¬ì†ŒìŠ¤ ìƒì„±</h2><h3 id=ì‰½ê²Œ-ì‚­ì œí• -ìˆ˜-ìˆë„ë¡-challengeë¥¼-ë§Œë“¤ì>ì‰½ê²Œ ì‚­ì œí•  ìˆ˜ ìˆë„ë¡ Challengeë¥¼ ë§Œë“¤ì!</h3><p>ChallengeëŠ” Deployment, Serviceë¥¼ í•˜ë‚˜ì˜ ì»´í¬ë„ŒíŠ¸ë¡œ êµ¬ì„±í•˜ì—¬ ìƒì„±í•˜ê²Œ ë©ë‹ˆë‹¤. <strong>ì‚­ì œ ì‹œ ê³ ì•„ ë¦¬ì†ŒìŠ¤ê°€ ë°œìƒí•˜ì§€ ì•Šë„ë¡ ìƒì„±í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.</strong>
ìœ„ì˜ ê³¼ì œë¥¼ ë‹¬ì„±í•˜ê¸° ìœ„í•´ì„œ Challenge-Deployment, Serviceê°„ ë¶€ëª¨-ìì‹ ê´€ê³„ë¥¼ ì§€ì •í–ˆìŠµë‹ˆë‹¤.</p><blockquote><p>Ownsì— ëŒ€í•´ì„œ ì†Œìœ  ê´€ê³„ë¼ê³  ë§í•˜ëŠ” ì‚¬ëŒì´ ìˆê³ , ì–´ëŠ ì±…ì—ì„œëŠ” ë¶€ëª¨-ìì‹ ê´€ê³„ë¼ê³  ì„¤ëª…í•˜ê¸°ë„ í–ˆìŠµë‹ˆë‹¤. ì €ëŠ” ìƒí•˜ ê´€ê³„ë¥¼ ëšœë ·í•˜ê²Œ í‘œí˜„í•  ìˆ˜ ìˆì–´ <strong>ë¶€ëª¨-ìì‹ ê´€ê³„</strong>ë¡œ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.</p></blockquote><p>ì‰½ê²Œ ë§í•´ ì»¤ìŠ¤í…€ ë¦¬ì†ŒìŠ¤(Challenge) ë¶€ëª¨ì´ê³  Deployment, Service ìì‹ ê´€ê³„ë¼ê³  ìƒê°í•˜ì‹œë©´ ë©ë‹ˆë‹¤. Challengeê°€ Deploymentê³¼ ì—°ê´€ëœë‹¤ëŠ” ê²ƒì€ Deploymentì— ë³€ê²½ ì‚¬í•­ ë°œìƒ ì‹œ Reconcile()ì´ ë°œìƒí•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.</p><p>ë¶€ëª¨-ìì‹ ê´€ê³„ë¥¼ ì‚¬ìš©í•œ ì´ìœ ëŠ” ì‚­ì œ ì‹œ í¸ë¦¬í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. êµ¬ì²´ì ìœ¼ë¡œ ë§í•˜ìë©´ <strong>ìì‹ ë¦¬ì†ŒìŠ¤ê°€ ë¶€ëª¨ ë¦¬ì†ŒìŠ¤ì— ì†Œì†ëœ ê²ƒìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆë‹¤ë©´ ë¶€ëª¨ ë¦¬ì†ŒìŠ¤ ì‚­ì œ ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ì€ ëª¨ë“  ìì‹ ë¦¬ì†ŒìŠ¤ë¥¼ ìë™ìœ¼ë¡œ ì •ë¦¬</strong>í•©ë‹ˆë‹¤.</p><h4 id=êµ¬í˜„>êµ¬í˜„</h4><p>ìƒì„± ì‹œ ì•„ë˜ì˜ ë¡œì§ì„ ë”°ë¦…ë‹ˆë‹¤.</p><ol><li>Challenge ê°ì²´ ì´ˆê¸°í™”</li><li>LoadDefinitionì„ ë¡œë“œ</li><li>LoadDefinition ê¸°ë°˜ìœ¼ë¡œ Deployment, Serviceë¥¼ ìƒì„±(ë¶€ëª¨-ìì‹ ê´€ê³„)</li><li>Challengeì— í•„ìš” ë ˆì´ë¸”ì„ ì¶”ê°€</li></ol><p>ì—¬ê¸°ì„œ ì´ˆê¸°í™” ë¶€ë¶„ì— <code>challenge.Status.StartedAt</code> ë¥¼ í˜„ì¬ ì‹œê°„ìœ¼ë¡œ ì €ì¥í–ˆìŠµë‹ˆë‹¤. ì´ ì†ì„±ê°’ì€ ì´ˆê¸°í™” í˜¹ì€ ì¶”í›„ 30ë¶„ í›„ì— ì‚­ì œí•˜ê¸° ìœ„í•´ ë¹„êµê°’ìœ¼ë¡œ í™œìš©ë©ë‹ˆë‹¤.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// ì²˜ìŒ ìƒì„± ì‹œ StartedAt ë“± Status ì´ˆê¸°í™”</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>challenge</span><span class=p>.</span><span class=nx>Status</span><span class=p>.</span><span class=nx>StartedAt</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nf>Get</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>req</span><span class=p>.</span><span class=nx>NamespacedName</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>challenge</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=nx>r</span><span class=p>.</span><span class=nf>handleError</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>req</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>challenge</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=nx>now</span> <span class=o>:=</span> <span class=nx>metav1</span><span class=p>.</span><span class=nf>Now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=nx>challenge</span><span class=p>.</span><span class=nx>Status</span><span class=p>.</span><span class=nx>StartedAt</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>now</span>
</span></span><span class=line><span class=cl>		<span class=nx>challenge</span><span class=p>.</span><span class=nx>Status</span><span class=p>.</span><span class=nx>CurrentStatus</span> <span class=p>=</span> <span class=o>*</span><span class=nx>hexactfproj</span><span class=p>.</span><span class=nf>NewCurrentStatus</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nf>Status</span><span class=p>().</span><span class=nf>Update</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>challenge</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>log</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=s>&#34;Failed to initialize status&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=nx>r</span><span class=p>.</span><span class=nf>handleError</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>req</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>challenge</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// ìµœì‹  ìƒíƒœë¡œ ê°±ì‹ </span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nf>Get</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>req</span><span class=p>.</span><span class=nx>NamespacedName</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>challenge</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>// NotFound ì—ëŸ¬ ë“±ì€ ë¬´ì‹œ</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>r</span><span class=p>.</span><span class=nf>handleError</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>req</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>challenge</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// í˜„ì¬ ìƒíƒœì— ë”°ë¼ ë¶„ê¸°</span>
</span></span><span class=line><span class=cl>	<span class=k>switch</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>case</span> <span class=nx>challenge</span><span class=p>.</span><span class=nx>Status</span><span class=p>.</span><span class=nx>CurrentStatus</span><span class=p>.</span><span class=nf>IsNone</span><span class=p>():</span>
</span></span><span class=line><span class=cl>		<span class=c1>// ...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nf>Get</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>req</span><span class=p>.</span><span class=nx>NamespacedName</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>challenge</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=nx>r</span><span class=p>.</span><span class=nf>handleError</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>req</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>challenge</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=c1>// ì‹¤ì œ Challengeì— í•„ìš”í•œ ë¦¬ì†ŒìŠ¤ë“¤(Deployment, Service ë“±) ìƒì„± ë¡œì§</span>
</span></span><span class=line><span class=cl>		<span class=nx>err</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nf>loadChallengeDefinition</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>req</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>challenge</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=nx>r</span><span class=p>.</span><span class=nf>handleError</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>req</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>challenge</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=c1>// í•œ ë²ˆ ë” ì¬í(Requeue)í•˜ì—¬ ë°”ë¡œ ë‹¤ìŒ ë‹¨ê³„ í™•ì¸</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>ctrl</span><span class=p>.</span><span class=nx>Result</span><span class=p>{</span><span class=nx>Requeue</span><span class=p>:</span> <span class=kc>true</span><span class=p>},</span> <span class=kc>nil</span>
</span></span></code></pre></td></tr></table></div></div><p>Deployment, Service ìƒì„± ì‹œ Challengeì— ëŒ€í•œ <code>SetControllerReference</code> ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  <code>Client.Create</code>ë¥¼ í†µí•´ Deployment,Serviceë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl>	<span class=c1>// Deploymentê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸</span>
</span></span><span class=line><span class=cl>	<span class=nx>err</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nf>Get</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>client</span><span class=p>.</span><span class=nx>ObjectKey</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Namespace</span><span class=p>:</span> <span class=nx>challenge</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Name</span><span class=p>:</span>      <span class=nx>deploy</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>},</span> <span class=nx>deploy</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>errors</span><span class=p>.</span><span class=nf>IsNotFound</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>log</span><span class=p>.</span><span class=nf>Info</span><span class=p>(</span><span class=s>&#34;Creating Deployment&#34;</span><span class=p>,</span> <span class=s>&#34;Deployment.Namespace&#34;</span><span class=p>,</span> <span class=nx>deploy</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>,</span> <span class=s>&#34;Deployment.Name&#34;</span><span class=p>,</span> <span class=nx>deploy</span><span class=p>.</span><span class=nx>Name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>			<span class=c1>// Owner Reference ì„¤ì •</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>ctrl</span><span class=p>.</span><span class=nf>SetControllerReference</span><span class=p>(</span><span class=nx>challenge</span><span class=p>,</span> <span class=nx>deploy</span><span class=p>,</span> <span class=nx>r</span><span class=p>.</span><span class=nx>Scheme</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=nx>log</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=s>&#34;failed to set controller reference&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>				<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=c1>// Deployment ìƒì„±</span>
</span></span><span class=line><span class=cl>			<span class=nx>err</span> <span class=p>=</span> <span class=nx>r</span><span class=p>.</span><span class=nx>Client</span><span class=p>.</span><span class=nf>Create</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>deploy</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=nx>log</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=s>&#34;failed to create Deployment&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>				<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>log</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=s>&#34;failed to get Deployment&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ê·¸ë¦¬ê³  ì»¨íŠ¸ë¡¤ëŸ¬ Builder ì´ˆê¸°í™” ë¶€ë¶„ì—ì„œ ì†Œìœ  ê´€ê³„ë¥¼ ëª…í™•íˆ êµ¬í˜„í•˜ì‹œë©´ ë©ë‹ˆë‹¤.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// SetupWithManager sets up the controller with the Manager.</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>r</span> <span class=o>*</span><span class=nx>ChallengeReconciler</span><span class=p>)</span> <span class=nf>SetupWithManager</span><span class=p>(</span><span class=nx>mgr</span> <span class=nx>ctrl</span><span class=p>.</span><span class=nx>Manager</span><span class=p>)</span> <span class=kt>error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// Builderë¥¼ ì´ˆê¸°í™”</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>ctrl</span><span class=p>.</span><span class=nf>NewControllerManagedBy</span><span class=p>(</span><span class=nx>mgr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=c1>// Challenge(ë¶€ëª¨ ë¦¬ì†ŒìŠ¤)</span>
</span></span><span class=line><span class=cl>		<span class=nf>For</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>hexactfproj</span><span class=p>.</span><span class=nx>Challenge</span><span class=p>{}).</span>
</span></span><span class=line><span class=cl>		<span class=c1>// Deployment(ìì‹ ë¦¬ì†ŒìŠ¤)</span>
</span></span><span class=line><span class=cl>		<span class=nf>Owns</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>Deployment</span><span class=p>{}).</span>
</span></span><span class=line><span class=cl>		<span class=c1>// Service(ìì‹ ë¦¬ì†ŒìŠ¤)</span>
</span></span><span class=line><span class=cl>		<span class=nf>Owns</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>Service</span><span class=p>{}).</span><span class=o>/</span>
</span></span><span class=line><span class=cl>		<span class=nf>Named</span><span class=p>(</span><span class=s>&#34;challenge&#34;</span><span class=p>).</span>
</span></span><span class=line><span class=cl>		<span class=c1>// Controllerì— ChallengeReconcilerë¥¼ ì‚½ì…</span>
</span></span><span class=line><span class=cl>		<span class=nf>Complete</span><span class=p>(</span><span class=nx>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=ìƒíƒœë¥¼-ê°ì§€í•˜ê³ -ë³€ê²½í•˜ëŠ”-ë°©ë²•>ìƒíƒœë¥¼ ê°ì§€í•˜ê³  ë³€ê²½í•˜ëŠ” ë°©ë²•</h3><p>ì™„ì „ ìƒˆë¡œìš´ Challengeë¼ë©´ ìƒíƒœ ê°’ê³¼ ê°™ì€ ê¸°íƒ€ ì •ë³´ë¥¼ ì´ˆê¸°í™”í•˜ì—¬ í•„ìš” ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ì´ ê³¼ì •ì—ì„œ None -> Running ìƒíƒœë¡œ ë³€ê²½í•˜ê²Œ ë˜ëŠ”ë°, ì½”ë“œ ìƒì—ì„œ ì°¸ì¡°í•˜ê³  ìˆëŠ” challengeì˜ status ê°’ì„ Runningë¥¼ ë³€ê²½í•˜ì—¬ ìƒˆë¡œìš´ ìƒíƒœë¥¼ ì¿ ë²„ë„¤í‹°ìŠ¤ì— ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl>		<span class=nx>challenge</span><span class=p>.</span><span class=nx>Status</span><span class=p>.</span><span class=nx>CurrentStatus</span><span class=p>.</span><span class=nf>SetRunning</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=nx>now</span> <span class=o>:=</span> <span class=nx>metav1</span><span class=p>.</span><span class=nf>Now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=nx>challenge</span><span class=p>.</span><span class=nx>Status</span><span class=p>.</span><span class=nx>StartedAt</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>now</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nf>Status</span><span class=p>().</span><span class=nf>Update</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>challenge</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=nx>r</span><span class=p>.</span><span class=nf>handleError</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>req</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>challenge</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=ì»¨íŠ¸ë¡¤ëŸ¬-êµ¬í˜„ì—-ì¤‘ìš”í•œ-ê²ƒì€---ë©±ë“±ì„±>ì»¨íŠ¸ë¡¤ëŸ¬ êµ¬í˜„ì— ì¤‘ìš”í•œ ê²ƒì€? - ë©±ë“±ì„±</h3><p>ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë§í•˜ëŠ” <strong>ë©±ë“±ì„±</strong>ì€ ë³€ê²½ ë˜ì§€ ì•ŠëŠ” ë¦¬ì†ŒìŠ¤ì˜ ì¡°ì • ìš”ì²­ì´ ì—¬ëŸ¬ë²ˆ ìˆë”ë¼ë„ <strong>ë§¤ë²ˆ ë™ì¼í•œ ê²°ê³¼</strong>ë¥¼ ê°€ì ¸ì™€ì•¼ í•œë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤. ë§Œì•½ì— í•˜ë‚˜ì˜ ë¶€ëª¨ ë¦¬ì†ŒìŠ¤ì— Deployment 1ê°œë¡œ êµ¬ì„±ëœ ìì‹ ë¦¬ì†ŒìŠ¤ë¥¼ ê°€ì ¸ì•¼ í•œë‹¤ê³  ê°€ì •í•´ë´…ì‹œë‹¤. ë¬´ìŠ¨ ì¼ì´ ë°œìƒí•˜ë”ë¼ë„ í•˜ë‚˜ì˜ ë¶€ëª¨ ë¦¬ì†ŒìŠ¤ì— ë¬´ì¡°ê±´ í•˜ë‚˜ì˜ Deploymentë¥¼ ê°€ì ¸ì•¼ í•©ë‹ˆë‹¤. ì¤‘ê°„ì— ì¶”ê°€ì ì¸ ìš”ì²­ì´ ë°œìƒí•˜ì—¬ Deploymentê°€ 2ê°œ ìƒì„±ëœë‹¤ë©´ ì´ê²ƒì€ ë©±ë“±ì„±ì´ ê¹¨ì§„ ê²ƒì…ë‹ˆë‹¤.</p><p>ë©±ë“±ì„±ì€ Challenge Controllerë¥¼ êµ¬í˜„í•˜ë©´ì„œ í˜„ì¬ê¹Œì§€ë„ ê°€ì¥ ì–´ë ¤ì›Œí•˜ëŠ” ë¶€ë¶„ì´ê¸°ë„ í•©ë‹ˆë‹¤.
ChallengeëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ê¸°ë³¸ ë¦¬ì†ŒìŠ¤ë¥¼ ê°€ì§€ê³  ìˆì§€ë§Œ ì ˆì°¨ì— ë”°ë¼ ë ˆì´ë¸”, ìƒíƒœ ê°’ì´ ì—…ë°ì´íŠ¸ ë©ë‹ˆë‹¤. ë³€ê²½ ì‚¬í•­ì´ ë§ì€ íƒ“ì— <strong>Reconcile ë¡œì§ì„ êµ¬í˜„í•  ë•ŒëŠ” ìµœì‹ ì˜ Challengeë¥¼ ë¶ˆëŸ¬ì˜¤ë„ë¡ êµ¬í˜„</strong>í•´ì•¼ í•©ë‹ˆë‹¤.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nf>Get</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>req</span><span class=p>.</span><span class=nx>NamespacedName</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>challenge</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>r</span><span class=p>.</span><span class=nf>handleError</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>req</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>challenge</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ Kubernetes Clientê°€ ì´ìš©í•˜ëŠ” Kubernetes Cacheì— ìˆëŠ” ìƒíƒœ ê°’ê³¼ ì‹¤ì œ ë°ì´í„°ì— ë¶ˆì¼ì¹˜ê°€ ë°œìƒí•´ ë¬¸ì œê°€ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;controller&#34;</span><span class=p>:</span> <span class=s2>&#34;challenge&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;controllerGroup&#34;</span><span class=p>:</span> <span class=s2>&#34;apps.hexactf.io&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;controllerKind&#34;</span><span class=p>:</span> <span class=s2>&#34;Challenge&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;Challenge&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;challenge-59-sample&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;namespace&#34;</span><span class=p>:</span> <span class=s2>&#34;default&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;namespace&#34;</span><span class=p>:</span> <span class=s2>&#34;default&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;challenge-59-sample&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;reconcileID&#34;</span><span class=p>:</span> <span class=s2>&#34;bf0eee44-a54d-417d-8322-7dc81e52152e&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;error&#34;</span><span class=p>:</span> <span class=s2>&#34;Operation cannot be fulfilled on challenges.apps.hexactf.io \&#34;challenge-59-sample\&#34;: the object has been modified; please apply your changes to the latest version and try again&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=challenge-ë¦¬ì†ŒìŠ¤-ì‚­ì œ>Challenge ë¦¬ì†ŒìŠ¤ ì‚­ì œ</h2><h3 id=ì‚­ì œ-ìƒíƒœë¥¼-ì•Œë¦¬ê¸°-ìœ„í•œ-finalizer-ì´ìš©>ì‚­ì œ ìƒíƒœë¥¼ ì•Œë¦¬ê¸° ìœ„í•œ Finalizer ì´ìš©</h3><p>ìƒí™©ì— ë”°ë¼ íŠ¹ë³„í•œ ì •ë¦¬ ë¡œì§ì´ í•„ìš”í•œ ê²½ìš°ê°€ ìˆìŠµë‹ˆë‹¤. ì´ëŸ´ ê²½ìš° Finzliazerë¥¼ í†µí•´ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚­ì œí•˜ì§€ ëª»í•˜ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ëŒ€í‘œì ì¸ ì˜ˆì‹œë¡œ pvc-protectionê°€ ìˆìœ¼ë©° ì´ìƒ íŒŒë“œê°€ ì ê·¹ì ìœ¼ë¡œ ì‚¬ìš©ë˜ì§€ ì•Šì„ë•Œê¹Œì§€ pvcì˜ ì‚­ì œê°€ ì—°ê¸°ë©ë‹ˆë‹¤.</p><blockquote><p>ì‹¤ì œë¡œ Finalizerë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´ ì‚­ì œëŠ” ë¹ ë¥´ê²Œ ë°œìƒë©ë‹ˆë‹¤.</p></blockquote><p>í”„ë¡œì íŠ¸ì—ì„œëŠ” ë¦¬ì†ŒìŠ¤ ê°„ ì¢…ì†ì ì¸ ê´€ê³„ë¥¼ ê°€ì§€ì§€ ì•Šê³  ëª¨ë‘ ë…ë¦½ì ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤. ê·¸ëŸ¬ë¯€ë¡œ pvc ì‚¬ë¡€ì²˜ëŸ¼ Finalizerê°€ í•„ìš” ì—†ë‹¤ê³  ìƒê°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ê·¸ëŸ¬ë‚˜ ì €í¬ í”„ë¡œì íŠ¸ëŠ” ì‚­ì œ ìƒíƒœ ì •ë³´ë¥¼ ì„¤ì •í•˜ì—¬ ì™¸ë¶€ì— ë³´ë‚´ì•¼ í•©ë‹ˆë‹¤. ë’¤ì—ì„œ ë§ì”€í•˜ê² ì§€ë§Œ ìƒíƒœ ì •ë³´ë¥¼ íë¥¼ í†µí•´ ì „ì†¡í•˜ê²Œ ë˜ëŠ”ë°, ì´ë•Œ ì‚­ì œ ìš”ì²­ -> ìƒíƒœ ë©”ì„¸ì§€ ì „ì†¡ -> ì‚­ì œ ë¡œì§ì´ êµ¬í˜„ì´ ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ê²°êµ­ ë¦¬ì†ŒìŠ¤ ì •ë¦¬ê°€ ì•„ë‹ˆë”ë¼ë„ <strong>ì‚­ì œê°€ ë˜ì—ˆë‹¤ëŠ” ìƒíƒœ ì •ë³´ë¥¼ ë‹¤ë¥¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ê²Œ ì•Œë ¤ì¤˜ì•¼ í•˜ëŠ” ì‹œê°„ì´ í•„ìš”í•˜ê²Œ ë©ë‹ˆë‹¤.</strong>
ì €ëŠ” ì´ëŸ¬í•œ ë¡œì§ì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ Finalizerë¥¼ ì‚¬ìš©í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>const</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=nx>challengeFinalizer</span> <span class=p>=</span> <span class=s>&#34;challenge.hexactf.io/finalizer&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>r</span> <span class=o>*</span><span class=nx>ChallengeReconciler</span><span class=p>)</span> <span class=nf>addFinalizer</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>challenge</span> <span class=o>*</span><span class=nx>hexactfproj</span><span class=p>.</span><span class=nx>Challenge</span><span class=p>)</span> <span class=p>(</span><span class=nx>ctrl</span><span class=p>.</span><span class=nx>Result</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>challenge</span><span class=p>.</span><span class=nx>Finalizers</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>challenge</span><span class=p>.</span><span class=nx>Finalizers</span><span class=p>,</span> <span class=nx>challengeFinalizer</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nf>Update</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>challenge</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>ctrl</span><span class=p>.</span><span class=nx>Result</span><span class=p>{},</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;failed to add finalizer: %w&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>ctrl</span><span class=p>.</span><span class=nx>Result</span><span class=p>{},</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=ë¦¬ì†ŒìŠ¤ê°€-ì‚­ì œë˜ëŠ”-2ê°€ì§€-ë°©ë²•>ë¦¬ì†ŒìŠ¤ê°€ ì‚­ì œë˜ëŠ” 2ê°€ì§€ ë°©ë²•</h3><p>ë¦¬ì†ŒìŠ¤ê°€ ì‚­ì œë˜ëŠ” ë°©ë²•ì€ í¬ê²Œ ë‘ ê°€ì§€ì…ë‹ˆë‹¤.</p><ol><li>ì‚¬ìš©ìê°€ ì‚­ì œë¥¼ ìš”ì²­í•œë‹¤.</li><li>ì´ìš© ì‹œê°„ì´ 30ë¶„ ì´ìƒì´ë©´ ì‚­ì œë¥¼ ìš”ì²­í•œë‹¤.</li></ol><p>ì‚­ì œ ìš”ì²­ì€ &ldquo;ì‚­ì œ ìš”ì²­í•˜ê² ìŠµë‹ˆë‹¤!&rdquo; ë¼ëŠ” <code>deletionTimestamp </code>ì†ì„±ë§Œ ê¸°ë¡ë˜ëŠ” ê²ƒ ë¿ì…ë‹ˆë‹¤. ì‹¤ì œë¡œëŠ” <code>deletionTimestamp</code>ê°€ ì„¤ì •ëœ ê²ƒì„ í™•ì¸í•˜ê³  Finalizerê°€ ì œê±°ëœ í›„ì— ëŒ€ìƒ ë¦¬ì†ŒìŠ¤ê°€ ì‚­ì œëœ ê²ƒì…ë‹ˆë‹¤.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>r</span> <span class=o>*</span><span class=nx>ChallengeReconciler</span><span class=p>)</span> <span class=nf>handleDeletion</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>challenge</span> <span class=o>*</span><span class=nx>hexactfproj</span><span class=p>.</span><span class=nx>Challenge</span><span class=p>)</span> <span class=p>(</span><span class=nx>ctrl</span><span class=p>.</span><span class=nx>Result</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>log</span><span class=p>.</span><span class=nf>Info</span><span class=p>(</span><span class=s>&#34;Processing deletion&#34;</span><span class=p>,</span> <span class=s>&#34;challenge&#34;</span><span class=p>,</span> <span class=nx>challenge</span><span class=p>.</span><span class=nx>Name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>crStatusMetric</span><span class=p>.</span><span class=nf>WithLabelValues</span><span class=p>(</span><span class=nx>challenge</span><span class=p>.</span><span class=nx>Labels</span><span class=p>[</span><span class=s>&#34;apps.hexactf.io/challengeId&#34;</span><span class=p>],</span> <span class=nx>challenge</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span> <span class=nx>challenge</span><span class=p>.</span><span class=nx>Labels</span><span class=p>[</span><span class=s>&#34;apps.hexactf.io/user&#34;</span><span class=p>],</span> <span class=nx>challenge</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>).</span><span class=nf>Set</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// Finalizerê°€ ë‚¨ì•„ìˆëŠ”ì§€ í™•ì¸</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>controllerutil</span><span class=p>.</span><span class=nf>ContainsFinalizer</span><span class=p>(</span><span class=nx>challenge</span><span class=p>,</span> <span class=s>&#34;challenge.hexactf.io/finalizer&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=c1>// íŒŒì´ë„ë¼ì´ì € ì œê±°</span>
</span></span><span class=line><span class=cl>		<span class=nx>controllerutil</span><span class=p>.</span><span class=nf>RemoveFinalizer</span><span class=p>(</span><span class=nx>challenge</span><span class=p>,</span> <span class=s>&#34;challenge.hexactf.io/finalizer&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=c1>// ë©”íƒ€ë°ì´í„° ì—…ë°ì´íŠ¸</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nf>Update</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>challenge</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>log</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=s>&#34;Failed to remove finalizer&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=c1>// ì¬ì‹œë„ ìœ„í•´ Requeue</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=nx>ctrl</span><span class=p>.</span><span class=nx>Result</span><span class=p>{</span><span class=nx>RequeueAfter</span><span class=p>:</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Second</span> <span class=o>*</span> <span class=mi>5</span><span class=p>},</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=c1>// í•„ìš”í•˜ë‹¤ë©´ Deleted ì´ë²¤íŠ¸ ì „ì†¡</span>
</span></span><span class=line><span class=cl>		<span class=nx>err</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nx>KafkaClient</span><span class=p>.</span><span class=nf>SendStatusChange</span><span class=p>(</span>
</span></span><span class=line><span class=cl>			<span class=nx>challenge</span><span class=p>.</span><span class=nx>Labels</span><span class=p>[</span><span class=s>&#34;apps.hexactf.io/user&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>			<span class=nx>challenge</span><span class=p>.</span><span class=nx>Labels</span><span class=p>[</span><span class=s>&#34;apps.hexactf.io/challengeId&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>			<span class=s>&#34;Deleted&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>log</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=s>&#34;Failed to send status change message&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=c1>// ì—¬ê¸°ì„œë„ ì—ëŸ¬ ì‹œ ì¬ì‹œë„</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=nx>ctrl</span><span class=p>.</span><span class=nx>Result</span><span class=p>{},</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>go</span> <span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=mi>1</span> <span class=o>*</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Minute</span><span class=p>)</span> <span class=c1>// scrape_intervalì´ 30ì´ˆë¼ë©´ 1ë¶„ ì •ë„ ê¸°ë‹¤ë¦¬ë©´ ì•ˆì „</span>
</span></span><span class=line><span class=cl>		<span class=nx>crStatusMetric</span><span class=p>.</span><span class=nf>DeleteLabelValues</span><span class=p>(</span><span class=nx>challenge</span><span class=p>.</span><span class=nx>Labels</span><span class=p>[</span><span class=s>&#34;apps.hexactf.io/challengeId&#34;</span><span class=p>],</span> <span class=nx>challenge</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span> <span class=nx>challenge</span><span class=p>.</span><span class=nx>Labels</span><span class=p>[</span><span class=s>&#34;apps.hexactf.io/user&#34;</span><span class=p>],</span> <span class=nx>challenge</span><span class=p>.</span><span class=nx>Namespace</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}()</span>
</span></span><span class=line><span class=cl>	<span class=nx>log</span><span class=p>.</span><span class=nf>Info</span><span class=p>(</span><span class=s>&#34;Successfully completed deletion process&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=c1>// ì´ ì‹œì ì—ì„œ finalizersê°€ ë¹„ì–´ ìˆìœ¼ë¯€ë¡œ, K8sê°€ ì˜¤ë¸Œì íŠ¸ë¥¼ ì‹¤ì œ ì‚­ì œí•¨</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>ctrl</span><span class=p>.</span><span class=nx>Result</span><span class=p>{},</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ol><li>ì‚¬ìš©ìê°€ ì‚­ì œë¥¼ ìš”ì²­í•œë‹¤.
ì‚¬ìš©ìê°€ ì‚­ì œë¥¼ ìš”ì²­í•˜ëŠ” ê²ƒì€ ì‚¬ìš©ìê°€ ì‚­ì œ ì´ë²¤íŠ¸ë¥¼ ì§ì ‘ í•˜ëŠ” ê²ƒê³¼ ê°™ìŠµë‹ˆë‹¤. ìš”ì²­ ì´í›„ì—ëŠ” ìë™ìœ¼ë¡œ deletionTimestampê°€ ê¸°ë¡ë  ê²ƒ ì…ë‹ˆë‹¤.</li></ol><p>ì•„ë˜ Reconcile() ë¡œì§ì— ì˜í•´ì„œ ì‚­ì œë¥¼ ìˆ˜í–‰í•  ê²ƒì…ë‹ˆë‹¤.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl> <span class=k>if</span> <span class=p>!</span><span class=nx>challenge</span><span class=p>.</span><span class=nx>DeletionTimestamp</span><span class=p>.</span><span class=nf>IsZero</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>r</span><span class=p>.</span><span class=nf>handleDeletion</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>challenge</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ol start=2><li>ì´ìš© ì‹œê°„ì´ 30ë¶„ ì´ìƒì´ë©´ ì‚­ì œë¥¼ ìš”ì²­í•œë‹¤.<br>Challenge ìƒì„± ë¶€ë¶„ì— ì‹¤í–‰ 30ë¶„ í›„ ì‚­ì œë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•´ <code>startedAt</code> ë¥¼ ì„¤ì •í•œë‹¤ê³  ë§í–ˆì£ ? startedAt ê¸°ì¤€ìœ¼ë¡œ 30ë¶„ í›„ì— ì‚­ì œë˜ë„ë¡ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>time</span><span class=p>.</span><span class=nf>Since</span><span class=p>(</span><span class=nx>challenge</span><span class=p>.</span><span class=nx>Status</span><span class=p>.</span><span class=nx>StartedAt</span><span class=p>.</span><span class=nx>Time</span><span class=p>)</span> <span class=p>&gt;</span> <span class=nx>challengeDuration</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=c1>// ì•„ì§ DeletionTimestampê°€ ì—†ë‹¤ë©´ Delete ìš”ì²­</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=nx>challenge</span><span class=p>.</span><span class=nx>DeletionTimestamp</span><span class=p>.</span><span class=nf>IsZero</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>				<span class=nx>log</span><span class=p>.</span><span class=nf>Info</span><span class=p>(</span><span class=s>&#34;Time exceeded; issuing a Delete request&#34;</span><span class=p>,</span> <span class=s>&#34;challenge&#34;</span><span class=p>,</span> <span class=nx>challenge</span><span class=p>.</span><span class=nx>Name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nf>Delete</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>challenge</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>					<span class=nx>log</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=s>&#34;Failed to delete challenge&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>					<span class=k>return</span> <span class=nx>r</span><span class=p>.</span><span class=nf>handleError</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>req</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>challenge</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>				<span class=p>}</span>
</span></span><span class=line><span class=cl>				<span class=c1>// Delete ìš”ì²­ í›„ì—ëŠ” Kubernetesê°€ DeletionTimestampë¥¼ ì„¤ì •í•˜ê³ </span>
</span></span><span class=line><span class=cl>				<span class=c1>// ë‹¤ì‹œ Reconcileì´ í˜¸ì¶œë˜ë©´ handleDeletion()ì´ ìˆ˜í–‰ë¨</span>
</span></span><span class=line><span class=cl>				<span class=k>return</span> <span class=nx>ctrl</span><span class=p>.</span><span class=nx>Result</span><span class=p>{},</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=c1>// ì´ë¯¸ Delete ì§„í–‰ì¤‘ì´ë©´ handleDeletionìœ¼ë¡œ</span>
</span></span><span class=line><span class=cl>				<span class=k>return</span> <span class=nx>r</span><span class=p>.</span><span class=nf>handleDeletion</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>challenge</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ë§Œì•½ ì œí•œ ì‹œê°„ ì´ë‚´ì— ìˆë‹¤ë©´ requeueë¥¼ í•©ë‹ˆë‹¤.<br>kube-apiserverë¥¼ í†µí•´ ëŒ€ìƒ ë¦¬ì†ŒìŠ¤ì˜ ë³€ê²½ ì‚¬í•­ ê°ì§€í•˜ë©´ ì´ë²¤íŠ¸ë¥¼ work queueì— ë„£ìŠµë‹ˆë‹¤. Controllerê°€ ì‹œì‘ë˜ë©´ Watch ë¡œì§ì„ í†µí•´ íì— ìˆëŠ” ë°ì´í„°ë¥¼ êµ¬ë…í•˜ê²Œ ë˜ê³  Reconcile() ë¡œì§ì„ ìˆ˜í–‰í•˜ê²Œ ë©ë‹ˆë‹¤.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl>	<span class=k>case</span> <span class=nx>challenge</span><span class=p>.</span><span class=nx>Status</span><span class=p>.</span><span class=nx>CurrentStatus</span><span class=p>.</span><span class=nf>IsRunning</span><span class=p>():</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nf>Get</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>req</span><span class=p>.</span><span class=nx>NamespacedName</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>challenge</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=nx>r</span><span class=p>.</span><span class=nf>handleError</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>challenge</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=c1>// isOneì´ falseì´ë©´ ì¼ì • ì‹œê°„ ë‚´ì—ë§Œ ì‘ë™</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=p>!</span><span class=nx>challenge</span><span class=p>.</span><span class=nx>Status</span><span class=p>.</span><span class=nx>IsOne</span> <span class=o>&amp;&amp;</span> <span class=nx>time</span><span class=p>.</span><span class=nf>Since</span><span class=p>(</span><span class=nx>challenge</span><span class=p>.</span><span class=nx>Status</span><span class=p>.</span><span class=nx>StartedAt</span><span class=p>.</span><span class=nx>Time</span><span class=p>)</span> <span class=p>&gt;</span> <span class=nx>challengeDuration</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=nx>r</span><span class=p>.</span><span class=nf>handleDeletion</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>challenge</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=p>!</span><span class=nx>challenge</span><span class=p>.</span><span class=nx>DeletionTimestamp</span><span class=p>.</span><span class=nf>IsZero</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=nx>r</span><span class=p>.</span><span class=nf>handleDeletion</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>challenge</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=c1>// Running ë©”ì„¸ì§€ ì „ì†¡</span>
</span></span><span class=line><span class=cl>		<span class=nx>err</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nx>KafkaClient</span><span class=p>.</span><span class=nf>SendStatusChange</span><span class=p>(</span><span class=nx>challenge</span><span class=p>.</span><span class=nx>Labels</span><span class=p>[</span><span class=s>&#34;apps.hexactf.io/user&#34;</span><span class=p>],</span> <span class=nx>challenge</span><span class=p>.</span><span class=nx>Labels</span><span class=p>[</span><span class=s>&#34;apps.hexactf.io/challengeId&#34;</span><span class=p>],</span> <span class=s>&#34;Running&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>log</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=s>&#34;Failed to send status change message&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=nx>r</span><span class=p>.</span><span class=nf>handleError</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>challenge</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>ctrl</span><span class=p>.</span><span class=nx>Result</span><span class=p>{</span><span class=nx>RequeueAfter</span><span class=p>:</span> <span class=nx>requeueInterval</span><span class=p>},</span> <span class=kc>nil</span>
</span></span></code></pre></td></tr></table></div></div><p>í”„ë¡œì íŠ¸ì— ëŒ€ì…í•´ë³´ìë©´ ì œí•œ ì‹œê°„ ë‚´ì— ìˆìœ¼ë©´ ëª‡ ë¶„ ê°„ê²©ìœ¼ë¡œ 30ë¶„ì´ ì§€ë‚¬ëŠ”ì§€ í™•ì¸í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.</p><p><img src=/p/hexactf-8/image-1.png width=720 height=340 srcset="/p/hexactf-8/image-1_hu_70aac238b179c19.png 480w, /p/hexactf-8/image-1_hu_25498fcfb3aa3dca.png 1024w" loading=lazy alt="ì¶œì²˜ - https://nakamasato.medium.com/kubernetes-operator-series-6-controller-runtime-component-controller-604c8905a1e1" class=gallery-image data-flex-grow=211 data-flex-basis=508px></p><p><strong>requeue Intervalì— ëŒ€í•œ ìƒê°</strong></p><p>ê¸°ë³¸ì ìœ¼ë¡œ ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” 30ì´ˆ ê°„ê²©ìœ¼ë¡œ ëª¨ë“  ë¦¬ì†ŒìŠ¤ì˜ ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤. Operator ë˜í•œ work queueì— requeueí•˜ì—¬ ë¦¬ì†ŒìŠ¤ ê°„ê²© ì‹œê°„ì„ ì„¤ì •í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤. ì—¬ê¸°ì„œ ëª‡ ì´ˆ ê°„ê²©ìœ¼ë¡œ ë³´ëŠ” ê²ƒì´ ì¢‹ì„ê¹Œìš”?</p><p>ìì£¼ ë¦¬ì†ŒìŠ¤ë¥¼ ê´€ì°°í•˜ê²Œ ë˜ë©´ íì— ë§ì€ ë°ì´í„°ê°€ ìŒ“ì´ê²Œ ë˜ë©´ì„œ ìµœì¢…ì ìœ¼ë¡œ ì‹œê°„ ì§€ì—°ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë°˜ë©´ í° ì‹œê°„ ê°„ê²©ìœ¼ë¡œ ê´€ì°°í•˜ê²Œ ë˜ë©´ &ldquo;ì§€ì†ì ìœ¼ë¡œ í™•ì¸í•˜ì—¬ ìƒíƒœ ì •ë³´ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸í•œë‹¤"ë¼ëŠ” ì¥ì ì„ ìƒì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì €ëŠ” ìµœì¢…ì ìœ¼ë¡œ 30ì´ˆ ê°„ê²©ìœ¼ë¡œ Challengeì˜ ìƒíƒœë¥¼ í™•ì¸í–ˆìŠµë‹ˆë‹¤.</p><blockquote><p><strong>ì—¬ë‹´</strong> .<br>ê¸€ë¡œ ì •ë¦¬í•˜ë‹¤ë³´ë‹ˆ 30ì´ˆ ê°„ê²©ìœ¼ë¡œ requeueí•  í•„ìš”ê°€ ì—†ë‹¤ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤. ì´ˆê¸°ì—ëŠ” ë¬´ìŠ¨ì¼ì´ ì¼ì–´ë‚ ì§€ ëª¨ë¥´ë‹ˆ 30ì´ˆ ê°„ê²©ìœ¼ë¡œ í™•ì¸í•˜ëŠ”ê²Œ ì¢‹ê² ë‹¤ê³  ìƒê°ì„ í–ˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ Challenge í•˜ìœ„ ë¦¬ì†ŒìŠ¤ì— ë³€ê²½ì‚¬í•­ì´ ê°ì§€ë˜ì–´ Reconcileë¥¼ ìˆ˜í–‰í•œë‹¤ë©´ 30ì´ˆ ê°„ê²©ì˜ RequeueëŠ” í•„ìš” ì—†ê² ì£ ?</p></blockquote><h2 id=ì •ë¦¬>ì •ë¦¬</h2><p>ìœ„ì˜ ë‚´ìš©ì„ íë¦„ë„ë¡œ ì •ë¦¬í•˜ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p><p><img src=/p/hexactf-8/image.png width=919 height=652 srcset="/p/hexactf-8/image_hu_a34d715bd16cc892.png 480w, /p/hexactf-8/image_hu_d1ab6704279ab332.png 1024w" loading=lazy alt="Challenge Operator íë¦„ë„" class=gallery-image data-flex-grow=140 data-flex-basis=338px></p><h2 id=ë§ˆì¹˜ë©°>ë§ˆì¹˜ë©°</h2><p>ê¸€ë¡œ ì •ë¦¬í•˜ë‹¤ë³´ë‹ˆ ìŠ¤ìŠ¤ë¡œ ì˜ëª» ìƒê°í•œ ë¶€ë¶„ì„ ì°¾ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ëŒ€í‘œì ì¸ ì˜ˆë¡œ Requeue(ì¬ì‹œë„) í•  í•„ìš” ì—†ëŠ”ë° êµ¬í˜„í•œ ê²ƒì²˜ëŸ¼ ë§ì´ì£ . ì´ê±´ ë‹¤ìŒì— ìˆ˜ì •í•´ì•¼ í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤.</p><p>ì´ë²ˆ ê¸€ì„ ëìœ¼ë¡œ ë¡œì§ ë¶€ë¶„ ì„¤ëª…ì€ ëë‚œ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ë‹¤ìŒ ê¸€ì—ì„œëŠ” ì–´ë–»ê²Œ ì»¤ìŠ¤í…€ ë©”íŠ¸ë¦­ì„ í†µí•´ Challengeë¥¼ ì‹œê°í™”í•  ìˆ˜ ìˆëŠ”ì§€ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.</p><h2 id=ì°¸ê³ >ì°¸ê³ </h2><ul><li><a class=link href=https://kmaster.tistory.com/106 target=_blank rel=noopener>Finalizers, ownerReferences</a></li><li><a class=link href=https://togomi.tistory.com/28 target=_blank rel=noopener>Kubernetes operator ë©”ì»¤ë‹ˆì¦˜</a></li><li><a class=link href=https://nakamasato.medium.com/kubernetes-operator-series-5-controller-runtime-component-reconciler-501f71b7397a target=_blank rel=noopener>Kubernetes Operator series 5â€” controller-runtime component â€” Reconciler | by Masato Naka | Medium</a></li><li><a class=link href=https://nakamasato.medium.com/kubernetes-operator-series-6-controller-runtime-component-controller-604c8905a1e1 target=_blank rel=noopener>Kubernetes Operator series 6 â€” controller-runtime component â€” Controller | by Masato Naka | Medium</a></li><li>ì œì‹œìŠ¨ ì œì‹œìŠ¨, ì¡°ìŠˆì•„ ìš°ë“œ. (2021). ì¿ ë²„ë„¤í‹°ìŠ¤ ì˜¤í¼ë ˆì´í„°. ì—ì´ì½˜.</li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/openstack/>Openstack</a>
<a href=/tags/kubernetes/>Kubernetes</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/hexactf-7/><div class=article-details><h2 class=article-title>HexaCTF 7. Challenge CR ìƒíƒœ ì •ì˜ì™€ Operator ê°œë… ì •ë¦¬</h2></div></a></article><article><a href=/p/hexactf-6/><div class=article-details><h2 class=article-title>HexaCTF 6. Kubebuilderë¥¼ í™œìš©í•œ ChallengeDefinition&amp;Challenge Type êµ¬í˜„</h2></div></a></article><article><a href=/p/hexactf-5/><div class=article-details><h2 class=article-title>HexaCTF 5. Kubernetes CRë¥¼ í™œìš©í•œ Challenge ì„¤ê³„</h2></div></a></article><article><a href=/p/hexactf-4/><div class=article-details><h2 class=article-title>HexaCTF 4. Dockerë¥¼ í™œìš©í•œ Challenge ì„¤ê³„ ë° í•œê³„ì </h2></div></a></article><article><a href=/p/hexactf-3/><div class=article-details><h2 class=article-title>HexaCTF - 3. Jenkinsë¥¼ í™œìš©í•œ CI í™˜ê²½ êµ¬ì„±í•˜ê¸°</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2024 -
2025 S0okJu.dev</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>