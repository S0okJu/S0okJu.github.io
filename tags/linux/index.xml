<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Linux on S0okJu.dev</title><link>https://s0okju.github.io/tags/linux/</link><description>Recent content in Linux on S0okJu.dev</description><generator>Hugo -- gohugo.io</generator><language>en</language><lastBuildDate>Tue, 28 May 2024 00:00:00 +0900</lastBuildDate><atom:link href="https://s0okju.github.io/tags/linux/index.xml" rel="self" type="application/rss+xml"/><item><title>그 많은 서버 디스크 용량을 누가 잡아 먹었는가?</title><link>https://s0okju.github.io/p/server-management-disk-1/</link><pubDate>Tue, 28 May 2024 00:00:00 +0900</pubDate><guid>https://s0okju.github.io/p/server-management-disk-1/</guid><description>&lt;p>Multipass를 구동하려고 하는 중 디스크 용량이 꽉찼다는 메세지를 얻게 되었다.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">cannot create temporary directory for the root file system: No space left on device
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>서버에서 사용중인 SSD는 1TB인데 5개의 Multipass 인스턴스로 다 찬다는 것은 말이 되지 않았다.&lt;/p>
&lt;p>&lt;img src="https://s0okju.github.io/p/server-management-disk-1/img1.png"
width="752"
height="206"
srcset="https://s0okju.github.io/p/server-management-disk-1/img1_hu_bfddb805cd3a384e.png 480w, https://s0okju.github.io/p/server-management-disk-1/img1_hu_3df0d2e23adb097b.png 1024w"
loading="lazy"
alt="df -h 결과"
class="gallery-image"
data-flex-grow="365"
data-flex-basis="876px"
>&lt;/p>
&lt;p>실제 하드웨어 상에서 부착된 용량과 ubuntu lvm에서 사용되는 최대 용량이 달랐다. 그러므로 이 용량을 적절하게 조절해야 한다.&lt;/p>
&lt;p>&lt;img src="https://s0okju.github.io/p/server-management-disk-1/img2.png"
width="690"
height="115"
srcset="https://s0okju.github.io/p/server-management-disk-1/img2_hu_7a8a582ccd866cae.png 480w, https://s0okju.github.io/p/server-management-disk-1/img2_hu_150efb3957288be.png 1024w"
loading="lazy"
alt="lsblk 결과"
class="gallery-image"
data-flex-grow="600"
data-flex-basis="1440px"
>&lt;/p>
&lt;h2 id="해결">해결
&lt;/h2>&lt;p>LV의 용량을 VG의 크기만큼 조절한다. &lt;a class="link" href="https://askubuntu.com/questions/1106795/ubuntu-server-18-04-lvm-out-of-space-with-improper-default-partitioning" target="_blank" rel="noopener"
>Stack Exchange&lt;/a>에서 요구한대로 명령어를 사용하면 해결된다.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">lvm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lvm&amp;gt; lvextend -l +100%FREE /dev/ubuntu-vg/ubuntu-lv
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lvm&amp;gt; &lt;span class="nb">exit&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">resize2fs /dev/ubuntu-vg/ubuntu-lv
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>자세하게 봐보자. ubuntu-vg는 SSD의 용량만큼 적절하게 할당 받았다. 그러나 Alloc PE를 보면 100 GB 밖에 남지 않았다는 것을 알 수 있다.&lt;/p>
&lt;p>&lt;img src="https://s0okju.github.io/p/server-management-disk-1/img3.png"
width="640"
height="466"
srcset="https://s0okju.github.io/p/server-management-disk-1/img3_hu_d8be1a9972764812.png 480w, https://s0okju.github.io/p/server-management-disk-1/img3_hu_593cde591a0a8c2b.png 1024w"
loading="lazy"
alt="vgdisplay 결과"
class="gallery-image"
data-flex-grow="137"
data-flex-basis="329px"
>&lt;/p>
&lt;p>&lt;code>lvdisplay&lt;/code>로 lv를 확인해보면 ubuntu-lv가 100GB로 할당되었음을 확인할 수 있다.&lt;/p>
&lt;p>&lt;img src="https://s0okju.github.io/p/server-management-disk-1/img4.png"
width="406"
height="50"
srcset="https://s0okju.github.io/p/server-management-disk-1/img4_hu_9fae2dac11c10c6c.png 480w, https://s0okju.github.io/p/server-management-disk-1/img4_hu_e6eaa65ee67de668.png 1024w"
loading="lazy"
alt="lvdisplay 결과"
class="gallery-image"
data-flex-grow="812"
data-flex-basis="1948px"
>&lt;/p>
&lt;p>여기서 LVM(Logical Volume Manager)의 개념을 알아야 하는데, 파일 시스템에 추상화 계층을 추가하여 논리적 스토리지를 생성할 수 있게 해준다.&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>&lt;/p>
&lt;p>&lt;img src="https://s0okju.github.io/p/server-management-disk-1/img5.png"
width="720"
height="671"
srcset="https://s0okju.github.io/p/server-management-disk-1/img5_hu_53fa4e24073d1a81.png 480w, https://s0okju.github.io/p/server-management-disk-1/img5_hu_4f1eb9bac622877f.png 1024w"
loading="lazy"
alt="출처 - https://medium.com/@yhakimi/lvm-how-to-create-and-extend-a-logical-volume-in-linux-9744f27eacfe"
class="gallery-image"
data-flex-grow="107"
data-flex-basis="257px"
>&lt;/p>
&lt;p>저자의 환경에서는 Root LV가 100GB로만 할당되어 있어, 하드 디스크의 용량 만큼 사용할 수 없었던 것이었다.&lt;/p>
&lt;p>&lt;img src="https://s0okju.github.io/p/server-management-disk-1/img6.png"
width="305"
height="375"
srcset="https://s0okju.github.io/p/server-management-disk-1/img6_hu_d2fcb7f6eed75cc4.png 480w, https://s0okju.github.io/p/server-management-disk-1/img6_hu_a8511e0bd8cb7e8d.png 1024w"
loading="lazy"
alt="VG, LV 관계도"
class="gallery-image"
data-flex-grow="81"
data-flex-basis="195px"
>&lt;/p>
&lt;p>현재 환경에서는 하나의 물리 디스크만 사용하기 때문에 설정하는데 복잡한 것은 없다. 그러므로 추가적으로 ubuntu-vg에 lv를 추가하지 않는 한 Root lv를 vg 크기만큼 사이즈를 키우면 된다.&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>&lt;a class="link" href="https://tech.cloud.nongshim.co.kr/2018/11/23/lvmlogical-volume-manager-1-%EA%B0%9C%EB%85%90/" target="_blank" rel="noopener"
>https://tech.cloud.nongshim.co.kr/2018/11/23/lvmlogical-volume-manager-1-%EA%B0%9C%EB%85%90/&lt;/a>&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item></channel></rss>